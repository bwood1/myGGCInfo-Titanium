<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="viewport" content="width=320, user-scalable=no">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>mySchedule</title>
<link rel="stylesheet" href="style.css" type="text/css" media="screen"
	title="no title" charset="utf-8">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script type="text/javascript">
	var scheduleArray;
	var semester;
	var year;
	var todaysDate;
	var uName;
	
	//add event listeners
	Ti.App.addEventListener('mySchedule:sendUsername', function(e) {
		// Ti.API.info('The username received: ' + e.username);
		uName = e.username;
	});
	
	Ti.App.addEventListener('schedule:mustLogIn', function() {
		// $("document").load('login.html');
		location.href = 'login.html';		
		// alert('You must log in to see your schedule');
	});
	
	Ti.App.addEventListener('mySchedule:sendSchedule', function(e) {
		scheduleArray = eval('(' + e.object + ')');
		// Ti.API.info('The schedule object is: ' + scheduleArray);
		// saveScheduleInfo();
		showScheduleInfo();
	});
	
	// Ti.App.addEventListener('androidBackPressed', function() {
		// document.location = 'index.html';
		// Ti.App.fireEvent('index:getLoggedInStatus');
	// });
	
	// Ti.App.addEventListener('androidBackPressed', function() {
		// backPressed();
	// });
	
	/* we are not going to save the schedule currently
	// Ti.App.addEventListener('mySchedule:sendSchedule', function(e) {
		// scheduleArray = e.schedule;
		// // alert(scheduleArray);
		// showScheduleInfo();
	// });
	*/

	/** We are not going to save the schedule currently
	 *	Checks to see if the students schedule is saved to the device and is updated
	 
	function checkSchedule() {
		//TODO check to see if the student's schedule is saved on the device 
		openSchedule();
		if(scheduleArray == null){
			alert('Schedule is null');
			retreiveScheduleInfo();
		}
		else{
			
		}
		showScheduleInfo();
		//TODO check to see if the student's schedule is current 
	}
	*/

	/**
	 *	Will retrieve the students schedule from the server and store it in variables
	 */
	function requestScheduleInfoFromServer() {
		//get the date first
		getSemester();
		
		//TODO write a script that will request the student's schedule from the server 
		Ti.App.fireEvent('mySchedule:openScheduleRequest', {username: uName, session: semester, 
			year: year, theDate: todaysDate});
	}
	
    /* we are not going to save the schecule currently
	/**
	 *	Will save the student's schedule to local storage
	 
	function saveScheduleInfo() {
		//TODO write a script to save the schedule on the device 
		// Ti.App.Properties.setString('studentSchedule', JSON.stringify(scheduleArray));
		Ti.App.fireEvent('mySchedule:saveSchedule', {scheduleObject: scheduleArray});
	}

	/**
	 *	Will get the student's schedule from the device and store it in variables
	 
	function openSchedule() {
		//TODO write a script to get the student's schedule from local storage 
		// Ti.API.info('open schedule file');
		Ti.App.fireEvent('mySchedule:openSchedule');
	}	*/
	
	/**
	 * Gets the current date and returns it as a string
	 */
	function getDate() {
		todaysDate = new Date();
		var today = (date.getMonth() +1) + '/' + date.getDate() + '/' + date.getFullYear();
		// Ti.API.info('todays date is ' + today);
	}
	
	/**
	 * Determines which semester and year to display
	 */
	function getSemester() {
		var date = new Date();
		year = date.getFullYear();
		if(date.getMonth() >= 0 && date.getMonth() < 4){
			semester = 'Spring';
		}
		else if(date.getMonth() >= 4 && date.getMonth() < 7){
			semester = "Summer";
		}
		else if(date.getMonth() >= 7 && date.getMonth() < 12){
			semester = "Fall";
		}
	}

	/**
	 *	Will show the student's schedule on screen
	 */
	function showScheduleInfo() {
		for(var i=0; i<6; i++){           //for each day
			//check to make sure there are classes
			var classesLength;
			if (scheduleArray.dayOfWeek[i].classes == null){
				classesLength = 0;
			}
			else classesLength = scheduleArray.dayOfWeek[i].classes.length;
			
		    for(var j=0; j < classesLength; j++){       //for each class
		        console.log('day: ' + scheduleArray.dayOfWeek[i].day + ' class ' + j + ": " + 
		        	scheduleArray.dayOfWeek[i].classes[j].subject + scheduleArray.dayOfWeek[i].classes[j].courseNum + 
                    scheduleArray.dayOfWeek[i].classes[j].section + scheduleArray.dayOfWeek[i].classes[j].building + 
                    scheduleArray.dayOfWeek[i].classes[j].roomNum + scheduleArray.dayOfWeek[i].classes[j].startTime +
                    scheduleArray.dayOfWeek[i].classes[j].endTime);
		        $("#"+i+"-"+j+"-0").html(scheduleArray.dayOfWeek[i].classes[j].subject);
		        $("#"+i+"-"+j+"-1").html(scheduleArray.dayOfWeek[i].classes[j].courseNum + "-" + 
                                         scheduleArray.dayOfWeek[i].classes[j].section);
                $("#"+i+"-"+j+"-2").html(scheduleArray.dayOfWeek[i].classes[j].building + "-" + 
                                         scheduleArray.dayOfWeek[i].classes[j].roomNum);
                $("#"+i+"-"+j+"-3").html(scheduleArray.dayOfWeek[i].classes[j].startTime); // + " - " + 
                                         //JSONObject.dayOfWeek[i].classes[j].endTime);
                $("#"+i+"-"+j+"-4").html(scheduleArray.dayOfWeek[i].classes[j].INSTRUCTOR_NAME);
		    }
		}
	}
	
	// What to do when the android back button is pressed
	function backPressed() {
		$('html').empty();
		$('html').load('index.html');
		// document.location='index.html';
		// Ti.App.fireEvent('index:getLoggedInStatus');
	}
    
    $(document).ready( function() {
    	Ti.App.fireEvent('mySchedule:getUNameFromProperties');
        requestScheduleInfoFromServer();
    });
</script>
</head>
<body>
	<div id="screen">
		<!-- Banner -->
		<!-- Top content -->
		<div style="padding: 5% 5% 10% 5%">
			<!-- backButton -->
			<div id="backDiv">
				<img width="100%" height="100%"
					onclick="document.location = 'index.html'" src="images/icons.png"
					alt="backButton">
				<figcaption>Back</figcaption>
			</div>
			<!-- /backButton -->
			<!-- myGGC Banner -->
			<div id="bannerDiv">
				<img alt="bannerImage" src="images/icons.png" width="100%"
					height="100%">
			</div>
		</div>
		<!-- /TopContent -->

		<br>

		<!-- scheduleContent -->
		<div id="scheduleContent" style="padding-top: 8%; height: 100%">
			<!-- monday -->
			<div id="monday">
				<div id="mondayLabel" style="text-align: left;">Monday</div>
				<div id="mondayClasses" style="text-align: left;">
					<table  style="border-color: white">
					    <tr>
					        <td id="0-0-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
					        <td id="0-0-1"> </td>      <!-- courseNum and sectionNum -->
					        <td id="0-0-2"> </td>      <!-- building and roomNum -->
					        <td id="0-0-3"> </td>      <!-- startTime and endTime -->
					        <td id="0-0-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
					        <td id="0-1-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="0-1-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="0-1-2"> </td>      <!-- building and roomNum -->
                            <td id="0-1-3"> </td>      <!-- startTime and endTime -->
                            <td id="0-1-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
                            <td id="0-2-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="0-2-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="0-2-2"> </td>      <!-- building and roomNum -->
                            <td id="0-2-3"> </td>      <!-- startTime and endTime -->
                            <td id="0-2-4"> </td>      <!-- professor -->
                        </tr>
                        <tr>
                            <td id="0-3-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="0-3-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="0-3-2"> </td>      <!-- building and roomNum -->
                            <td id="0-3-3"> </td>      <!-- startTime and endTime -->
                            <td id="0-3-4"> </td>      <!-- professor -->
                        </tr>
					</table>
				</div>
			</div>
			<!-- /monday -->

			<!-- tuesday -->
			<div id="tuesday">
				<div id="tuesdayLabel" style="text-align: left;">Tuesday</div>
				<div id="tuesdayClasses" style="text-align: left;">
						<table  style="border-color: white">
					    <tr>
					        <td id="1-0-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
					        <td id="1-0-1"> </td>      <!-- courseNum and sectionNum -->
					        <td id="1-0-2"> </td>      <!-- building and roomNum -->
					        <td id="1-0-3"> </td>      <!-- startTime and endTime -->
					        <td id="1-0-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
					        <td id="1-1-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="1-1-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="1-1-2"> </td>      <!-- building and roomNum -->
                            <td id="1-1-3"> </td>      <!-- startTime and endTime -->
                            <td id="1-1-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
                            <td id="1-2-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="1-2-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="1-2-2"> </td>      <!-- building and roomNum -->
                            <td id="1-2-3"> </td>      <!-- startTime and endTime -->
                            <td id="1-2-4"> </td>      <!-- professor -->
                        </tr>
                        <tr>
                            <td id="1-3-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="1-3-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="1-3-2"> </td>      <!-- building and roomNum -->
                            <td id="1-3-3"> </td>      <!-- startTime and endTime -->
                            <td id="1-3-4"> </td>      <!-- professor -->
                        </tr>
					</table>
					
				</div>
			</div>
			<!-- /tuesday -->

			<!-- wednesday -->
			<div id="wednesday">
				<div id="wednesdayLabel" style="text-align: left;">Wednesday</div>
				<div id="wednesdayClasses" style="text-align: left;">
						<table  style="border-color: white">
					    <tr>
					        <td id="2-0-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
					        <td id="2-0-1"> </td>      <!-- courseNum and sectionNum -->
					        <td id="2-0-2"> </td>      <!-- building and roomNum -->
					        <td id="2-0-3"> </td>      <!-- startTime and endTime -->
					        <td id="2-0-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
					        <td id="2-1-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="2-1-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="2-1-2"> </td>      <!-- building and roomNum -->
                            <td id="2-1-3"> </td>      <!-- startTime and endTime -->
                            <td id="2-1-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
                            <td id="2-2-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="2-2-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="2-2-2"> </td>      <!-- building and roomNum -->
                            <td id="2-2-3"> </td>      <!-- startTime and endTime -->
                            <td id="2-2-4"> </td>      <!-- professor -->
                        </tr>
                        <tr>
                            <td id="2-3-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="2-3-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="2-3-2"> </td>      <!-- building and roomNum -->
                            <td id="2-3-3"> </td>      <!-- startTime and endTime -->
                            <td id="2-3-4"> </td>      <!-- professor -->
                        </tr>
					</table>
					
				</div>
			</div>
			<!-- /wedensday -->

			<!-- thursday -->
			<div id="thursday">
				<div id="thursdayLabel" style="text-align: left;">Thursday</div>
				<div id="thursdayClasses" style="text-align: left;">
						<table  style="border-color: white">
					    <tr>
					        <td id="3-0-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
					        <td id="3-0-1"> </td>      <!-- courseNum and sectionNum -->
					        <td id="3-0-2"> </td>      <!-- building and roomNum -->
					        <td id="3-0-3"> </td>      <!-- startTime and endTime -->
					        <td id="3-0-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
					        <td id="3-1-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="3-1-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="3-1-2"> </td>      <!-- building and roomNum -->
                            <td id="3-1-3"> </td>      <!-- startTime and endTime -->
                            <td id="3-1-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
                            <td id="3-2-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="3-2-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="3-2-2"> </td>      <!-- building and roomNum -->
                            <td id="3-2-3"> </td>      <!-- startTime and endTime -->
                            <td id="3-2-4"> </td>      <!-- professor -->
                        </tr>
                        <tr>
                            <td id="3-3-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="3-3-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="3-3-2"> </td>      <!-- building and roomNum -->
                            <td id="3-3-3"> </td>      <!-- startTime and endTime -->
                            <td id="3-3-4"> </td>      <!-- professor -->
                        </tr>
					</table>
					
				</div>
			</div>
			<!-- /thursday -->

			<!-- friday -->
			<div id="friday">
				<div id="fridayLabel" style="text-align: left;">Friday</div>
				<div id="fridayClasses" style="text-align: left;">
						<table  style="border-color: white">
					    <tr>
					        <td id="4-0-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
					        <td id="4-0-1"> </td>      <!-- courseNum and sectionNum -->
					        <td id="4-0-2"> </td>      <!-- building and roomNum -->
					        <td id="4-0-3"> </td>      <!-- startTime and endTime -->
					        <td id="4-0-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
					        <td id="4-1-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="4-1-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="4-1-2"> </td>      <!-- building and roomNum -->
                            <td id="4-1-3"> </td>      <!-- startTime and endTime -->
                            <td id="4-1-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
                            <td id="4-2-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="4-2-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="4-2-2"> </td>      <!-- building and roomNum -->
                            <td id="4-2-3"> </td>      <!-- startTime and endTime -->
                            <td id="4-2-4"> </td>      <!-- professor -->
                        </tr>
                        <tr>
                            <td id="4-3-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="4-3-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="4-3-2"> </td>      <!-- building and roomNum -->
                            <td id="4-3-3"> </td>      <!-- startTime and endTime -->
                            <td id="4-3-4"> </td>      <!-- professor -->
                        </tr>
					</table>
				</div>
			</div>
			<!-- /friday -->
			
			<!-- saturday -->
			<div id="saturday">
				<div id="saturdayLabel" style="text-align: left;">Saturday</div>
				<div id="saturdayClasses" style="text-align: left;">
						<table  style="border-color: white">
					    <tr>
					        <td id="5-0-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
					        <td id="5-0-1"> </td>      <!-- courseNum and sectionNum -->
					        <td id="5-0-2"> </td>      <!-- building and roomNum -->
					        <td id="5-0-3"> </td>      <!-- startTime and endTime -->
					        <td id="5-0-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
					        <td id="5-1-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="5-1-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="5-1-2"> </td>      <!-- building and roomNum -->
                            <td id="5-1-3"> </td>      <!-- startTime and endTime -->
                            <td id="5-1-4"> </td>      <!-- professor -->
					    </tr>
					    <tr>
                            <td id="5-2-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="5-2-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="5-2-2"> </td>      <!-- building and roomNum -->
                            <td id="5-2-3"> </td>      <!-- startTime and endTime -->
                            <td id="5-2-4"> </td>      <!-- professor -->
                        </tr>
                        <tr>
                            <td id="5-3-0"> </td>      <!-- dayOfWeek(Monday)-class(CHEM)-column(Subject) -->
                            <td id="5-3-1"> </td>      <!-- courseNum and sectionNum -->
                            <td id="5-3-2"> </td>      <!-- building and roomNum -->
                            <td id="5-3-3"> </td>      <!-- startTime and endTime -->
                            <td id="5-3-4"> </td>      <!-- professor -->
                        </tr>
					</table>
				</div>
			</div>
			<!-- /saturday -->
		</div>
		<!-- /scheduleContent -->
	</div>
	<!-- /screen -->
</body>
</html>